# AWS EC2 + RDS + Spring Boot Demo

This is a simple demo project using Spring Boot with PostgreSQL on AWS EC2 + RDS setup.

---

## 1. Tech Stack

| Item             | Value                             |
|------------------|-----------------------------------|
| Java             | 21                                |
| Spring Boot      | 3.5.3                             |
| Database         | PostgreSQL (on Amazon RDS)        |
| Server           | EC2 (Amazon Linux 2023, t3.micro) |
| Deployment       | Manual via SCP                    |

---

## 2. AWS Infrastructure

### ⚪️ VPC

| Setting     | Value                             |
|-------------|-----------------------------------|
| Name        | `aws-ec2-rds-springboot-demo-vpc` |
| IPv4 CIDR   | `10.0.0.0/16`                     |

### ⚪️ Subnets

| Name                                 | Type     | AZ               | CIDR Block     |
|--------------------------------------|----------|------------------|----------------|
| aws-ec2-rds-springboot-demo-public   | Public   | ap-northeast-1a  | 10.0.10.0/24   |
| aws-ec2-rds-springboot-demo-private1 | Private  | ap-northeast-1a  | 10.0.20.0/24   |

### ⚪️ Internet Gateway

| Name |
|------|
| `aws-ec2-rds-springboot-demo-igw` |

### ⚪️ Route Tables

| Name                                  | Subnet Association                                | Routes                  |
|---------------------------------------|---------------------------------------------------|-------------------------|
| aws-ec2-rds-springboot-demo-public-rt | public subnet                                     | 0.0.0.0/0 → IGW         |
| aws-ec2-rds-springboot-demo-private-rt| private subnet                                 | (no IGW route required) |

### ⚪️ Security Groups

#### EC2 Security Group: `aws-ec2-rds-springboot-demo-ec2-sg`

| Type       | Protocol | Port | Source     |
|------------|----------|------|------------|
| SSH        | TCP      | 22   | 0.0.0.0/0  |
| Custom TCP | TCP      | 8080 | 0.0.0.0/0  |

> Outbound: All traffic allowed

#### RDS Security Group: `aws-ec2-rds-springboot-demo-rds-sg`

| Type       | Protocol | Port  | Source Security Group               |
|------------|----------|-------|-------------------------------------|
| PostgreSQL | TCP      | 5432  | `aws-ec2-rds-springboot-demo-ec2-sg` |

> Outbound: All traffic allowed

> ✅ Only access from the EC2 instance is allowed, blocking external access to enhance security.

---

## 3. EC2 Setup

| Item           | Value                                 |
|----------------|----------------------------------------|
| Instance Name  | aws-ec2-rds-springboot-demo            |
| AMI            | Amazon Linux 2023                      |
| Type           | t3.micro                               |
| Key Pair       | aws-ec2-rds-springboot-demo-key.pem    |
| Elastic IP     | Assigned     |

---

## 4. RDS Setup

| Item                    | Value                                             |
|-------------------------|---------------------------------------------------|
| DB Engine               | PostgreSQL                                        |
| Version                 | 17.4-R1                                           |
| DB Identifier           | aws-ec2-rds-springboot-demo                       |
| DB Name                 | aws_ec2_rds_springboot_demo                       |
| Deployment              | Single AZ                                         |
| Subnet Group            | Private Subnets (`private1`)                      |
| Authentication          | AWS Secrets Manager                               |
| Master Username         | `postgres`                                        |
| Secret ARN              | (auto-generated by Secrets Manager)               |

### RDS Instance Details

| Item                | Value               |
|---------------------|---------------------|
| DB Instance Class   | db.t4g.micro        |
| vCPUs / RAM         | 2 vCPUs / 1 GiB     |
| Network Throughput  | 最大 2,085 Mbps     |
| Storage Type        | General Purpose (gp2) |
| Allocated Storage   | 20 GiB              |
| Free Tier Eligible  | ✅ Yes              |
| Multi-AZ            | ❌ Single AZ        |
| Availability Zone   | ap-northeast-1a     |

### Connect to RDS using psql

```bash
psql -h aws-ec2-rds-springboot-demo.czkaqkmam2pw.ap-northeast-1.rds.amazonaws.com \
     -U postgres \
     -d aws_ec2_rds_springboot_demo \
     -p 5432
```

---

## 5. Spring Boot Project Structure and Setup

```plaintext
aws-ec2-rds-springboot-demo
├── build.gradle
├── src
　   └── main
　       ├── java
　       │   └── com.devtkms.awsec2rdsspringbootdemo
　       │       ├── AwsEc2RdsSpringbootDemoApplication.java
　       │       ├── UserController.java
　       │       ├── UserEntity.java
　       │       └── UserRepository.java
　       └── resources
　　          └── application.properties
```

### Build the JAR file

```bash
./gradlew bootJar
```

### Confirm the JAR is generated

```bash
ls build/libs/
# → aws-ec2-rds-springboot-demo-0.0.1-SNAPSHOT.jar
```


## 6. Deploy to EC2

### Connect to EC2 via SSH

```bash
# Move to the folder where the .pem file is located
cd <path-to-pem-file>

# Secure the key file
chmod 400 aws-ec2-springboot-demo-key.pem

# Connect via SSH
ssh -i "aws-ec2-rds-springboot-demo.pem" ec2-user@<your-elastic-ip>
```

### Install Java on EC2

```bash
# Install Amazon Corretto 21 (Java 21)
sudo yum install java-21-amazon-corretto-headless -y

# Confirm installation
java -version
```

### Transfer the JAR file to EC2

```bash
# Run from local terminal (not EC2)
scp -i aws-ec2-springboot-demo-key.pem \
build/libs/aws-ec2-rds-springboot-demo-0.0.1-SNAPSHOT.jar \
ec2-user@<your-elastic-ip>:/home/ec2-user/
```

---

## 7. Run the App on EC2

```bash
# SSH into EC2 (if not already connected)
ssh -i "aws-ec2-rds-springboot-demo.pem" ec2-user@<your-elastic-ip>

# Run the Spring Boot app
java -jar aws-ec2-rds-springboot-demo-0.0.1-SNAPSHOT.jar
```

---

## 8. Confirm the Application is Running

Once the JAR file is deployed and the application is running on EC2, you can verify it by sending requests using curl.

### Create a User (POST /users)
```bash
curl -X POST http://<your-elastic-ip>:8080/users \
  -H "Content-Type: application/json" \
  -d '{"name": "devtkms", "email": "devtkms@example.com"}'
```
<img width="511" alt="スクリーンショット 2025-07-06 19 37 02" src="https://github.com/user-attachments/assets/bb6b584e-4978-485a-a84e-209fedd1c33a" />

### Get All Users (GET /users)
```bash
curl http://<your-elastic-ip>:8080/users
```
<img width="511" alt="スクリーンショット 2025-07-06 19 37 13" src="https://github.com/user-attachments/assets/ff9908a9-70c5-4e9a-b76a-f35b752262d1" />

## 9. Confirm the Data in RDS

After sending requests to your Spring Boot application, you can connect directly to the RDS instance using `psql` to verify that the data was persisted correctly.

### Connect to RDS using `psql`

```bash
psql -h aws-ec2-rds-springboot-demo.czkaqkmam2pw.ap-northeast-1.rds.amazonaws.com -U postgres -d aws_ec2_rds_springboot_demo
```

### Check the Data in user_entity Table
Once connected to the database, run the following SQL:
```sql
SELECT * FROM user_entity;
```

### Expected Output
<img width="328" alt="スクリーンショット 2025-07-06 19 37 53" src="https://github.com/user-attachments/assets/71e862b4-3a74-4751-a230-425bc9c1e956" />

In this demo, id = 7 is shown because several test inserts were made before this example.






